<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmberFrame Desktop</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/desktop.css') }}">
</head>
<body>
    <div class="desktop" id="desktop">
        <!-- Desktop Icons -->
        <div class="desktop-icon" style="top: 20px; left: 20px;" data-app="file-manager">
            <div class="icon-image">ğŸ“</div>
            <div class="icon-label">File Manager</div>
        </div>

        <div class="desktop-icon" style="top: 20px; left: 120px;" data-app="terminal">
            <div class="icon-image">ğŸ’»</div>
            <div class="icon-label">Terminal</div>
        </div>

        <div class="desktop-icon" style="top: 120px; left: 20px;" data-app="text-editor">
            <div class="icon-image">ğŸ“</div>
            <div class="icon-label">Text Editor</div>
        </div>

        <div class="desktop-icon" style="top: 120px; left: 120px;" data-app="settings">
            <div class="icon-image">âš™ï¸</div>
            <div class="icon-label">Settings</div>
        </div>

        <!-- Public Folder Icon -->
        <div class="desktop-icon" style="top: 220px; left: 20px;" data-app="public-folder">
            <div class="icon-image" style="background: #28a745;">ğŸŒ</div>
            <div class="icon-label">Public</div>
        </div>
    </div>

    <!-- Windows Container -->
    <div id="windows-container"></div>

    <!-- File Browser Dialog -->
    <div class="file-browser-dialog" id="file-browser-dialog">
        <div class="file-browser-header">
            <div class="file-browser-title">Choose File</div>
            <div class="file-browser-controls">
                <button class="file-browser-close" onclick="FileBrowser.close()">âœ•</button>
            </div>
        </div>
        <div class="file-browser-content">
            <div class="file-browser-toolbar">
                <button onclick="FileBrowser.goBack()" id="fb-back-btn" disabled>â† Back</button>
                <button onclick="FileBrowser.goHome()">ğŸ  Home</button>
                <span class="file-path" id="fb-current-path">/</span>
            </div>
            <div class="file-browser-list" id="file-browser-list"></div>
            <div class="file-browser-actions">
                <input type="text" id="fb-filename" placeholder="File name..." class="file-browser-input">
                <button id="fb-action-btn" class="primary">Open</button>
                <button onclick="FileBrowser.close()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Taskbar -->
    <div class="taskbar">
        <button class="start-button" id="start-button">ğŸ”¥ Start</button>
        <div class="taskbar-apps" id="taskbar-apps"></div>
        <div class="system-tray">
            <span class="username">{{ username }}</span>
            <div class="time" id="time"></div>
            <button class="logout-btn" onclick="logout()">â»</button>
        </div>
    </div>

    <!-- Start Menu -->
    <div class="start-menu" id="start-menu">
        <div class="start-menu-header">
            <h3>EmberFrame</h3>
            <input type="text" class="start-menu-search" placeholder="Search apps..." id="app-search">
        </div>
        <div class="start-menu-apps" id="start-menu-apps">
            <div class="start-menu-app" data-app="file-manager">
                <div class="start-menu-app-icon">ğŸ“</div>
                <div>File Manager</div>
            </div>
            <div class="start-menu-app" data-app="terminal">
                <div class="start-menu-app-icon">ğŸ’»</div>
                <div>Terminal</div>
            </div>
            <div class="start-menu-app" data-app="text-editor">
                <div class="start-menu-app-icon">ğŸ“</div>
                <div>Text Editor</div>
            </div>
            <div class="start-menu-app" data-app="settings">
                <div class="start-menu-app-icon">âš™ï¸</div>
                <div>Settings</div>
            </div>
            <div class="start-menu-app" data-app="public-folder">
                <div class="start-menu-app-icon" style="background: #28a745;">ğŸŒ</div>
                <div>Public Folder</div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="context-menu">
        <div class="context-menu-item" onclick="location.reload()">Refresh Desktop</div>
        <div class="context-menu-item" onclick="createNewFile()">New File</div>
        <div class="context-menu-item" onclick="createNewFolder()">New Folder</div>
        <div class="context-menu-item" onclick="showProperties()">Properties</div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notification-container"></div>

    <!-- Core Scripts -->
    <script src="{{ url_for('static', filename='js/desktop-core.js') }}"></script>
    <script src="{{ url_for('static', filename='js/window-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/file-browser.js') }}"></script>
    <script src="{{ url_for('static', filename='js/notification.js') }}"></script>

    <!-- App Scripts -->
    <script src="{{ url_for('static', filename='js/apps/file-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/apps/terminal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/apps/text-editor.js') }}"></script>
    <script src="{{ url_for('static', filename='js/apps/settings.js') }}"></script>

    <script>
        // Global functions
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '/logout';
            }
        }

        function createNewFile() {
            window.WindowManager.openApp('text-editor');
        }

        function createNewFolder() {
            window.WindowManager.openApp('file-manager');
        }

        function showProperties() {
            window.WindowManager.openApp('settings');
        }

        // Handle drag and drop on desktop
        document.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        document.addEventListener('drop', (e) => {
            e.preventDefault();
            if (e.dataTransfer.files.length > 0) {
                // Handle file drops
                Array.from(e.dataTransfer.files).forEach(file => {
                    console.log('File dropped:', file.name);
                    // TODO: Implement file upload to user directory
                });
            }
        });
    </script>
</body>
</html>